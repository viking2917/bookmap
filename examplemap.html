<!DOCTYPE html>
<html lang="en">

<!-- caveat emptor: first versions of this created with Claude.AI. For fun only :)  -->

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenHistoricalMaps - Custom POI Markers</title>
  <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    #map {
      width: 100%;
      height: 100vh;
    }

    .info-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      max-width: 300px;
    }

    .info-panel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }

    .info-panel p {
      margin: 5px 0;
      font-size: 14px;
    }

    .maplibregl-popup-content {
      padding: 10px;
    }

    .maplibregl-popup-content h4 {
      margin: 0 0 5px 0;
    }

    .maplibregl-marker {
      z-index: 1000 !important;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div class="info-panel">
    <h3>Instructions</h3>
    <p>Edit the <code>pointsOfInterest</code> array in the code to add your locations.</p>
    <!-- <p><strong>Format:</strong> [latitude, longitude, "Name", "Description"]</p> -->
    <!-- <p><em>Note: longitude comes first!</em></p> -->
  </div>

  <script>
    // ==============================================
    // EDIT YOUR POINTS OF INTEREST HERE
    // ==============================================
    // IMPORTANT: Format is [LONGITUDE, LATITUDE, name, description]
    // Longitude comes FIRST (this is different from Leaflet!)
    const pointsOfInterest = [
      [51.5074, -0.1278, "London", "London, England"],
      [48.8566, 2.3522, "Paris", "Paris, France"],
      [31.7683, 35.2137, "Jerusalem", "Jerusalem"],
      [32.9236, 35.0710, "Acre", "Acre, Israel"],
      [38.1938, 15.5540, "Messina", "Messina, Sicily"],
      [34.7071, 33.0226, "Limassol", "Limassol, Cyprus"],
    ];

    const rome = [12.49637, 41.90278];
    // Create GeoJSON from points
    const geojson = {
      type: 'FeatureCollection',
      features: pointsOfInterest.map(poi => ({
        type: 'Feature',
        geometry: {
          type: 'Point',
          // lat/lon reversed in this map library...
          coordinates: [poi[1], poi[0]]
        },
        properties: {
          name: poi[2],
          description: poi[3]
        }
      }))
    };

    // ==============================================
    // MAP CONFIGURATION
    // ==============================================

    // Initialize the map with OpenHistoricalMap style
    //  style: 'https://unpkg.com/@openhistoricalmap/map-styles@latest/dist/woodblock/woodblock.json',
    const map = new maplibregl.Map({
      container: 'map',
      style: 'https://viking2917.github.io/bookmap/standard.json',
      center: [rome[0], rome[1]], // Default center [lng, lat]
      zoom: 4
    });

    // Add navigation controls (zoom buttons)
    map.addControl(new maplibregl.NavigationControl(), 'top-left');

    // Add scale control
    map.addControl(new maplibregl.ScaleControl({
      maxWidth: 200,
      unit: 'metric'
    }), 'bottom-left');


    // ==============================================
    // OPTIONAL: DATE FILTERING
    // ==============================================
    // Uncomment the code below to filter the map by a specific year
    // This is useful for viewing historical data from a specific time period
    map.on('styledata', function () {
      // Set the year you want to display (example: 1900)
      const targetYear = 1000;
      const targetDate = `${targetYear}-01-01`;

      // Apply date filter if the function exists
      if (map.filterByDate) {
        map.filterByDate(targetDate);
      }
    });

    // ==============================================
    // ADD MARKERS AFTER MAP LOADS
    // ==============================================

    // ─────────────────────────────────────
    // 1️⃣ Add point source
    // ─────────────────────────────────────

    map.on('load', function () {
      // Add source
      map.addSource('poi-source', {
        type: 'geojson',
        data: geojson
      });

      // ─────────────────────────────────────
      // 2️⃣ Outer engraved ring(s)
      // ─────────────────────────────────────
      map.addLayer({
        id: "marker-ring-2",
        type: "circle",
        source: "poi-source",
        paint: {
          "circle-radius": [
            "interpolate",
            ["linear"],
            ["zoom"],
            4, 6,
            10, 10
          ],
          "circle-color": "rgba(0,0,0,0)",
          "circle-stroke-width": 1,
          "circle-stroke-color": "rgba(255,255,255,0.5)",
          "circle-stroke-opacity": 0.9
        }
      });

      map.addLayer({
        id: "marker-ring",
        type: "circle",
        source: "poi-source",
        paint: {
          "circle-radius": [
            "interpolate",
            ["linear"],
            ["zoom"],
            4, 4,
            10, 8
          ],
          "circle-color": "rgba(0,0,0,0)",
          "circle-stroke-width": 2,
          "circle-stroke-color": "#696969",
          "circle-stroke-opacity": 0.9
        }
      });

      // ─────────────────────────────────────
      // 3️⃣ Inner ink dot
      // ─────────────────────────────────────
      map.addLayer({
        id: "marker-core",
        type: "circle",
        source: "poi-source",
        paint: {
          "circle-radius": [
            "interpolate",
            ["linear"],
            ["zoom"],
            4, 3,
            10, 6
          ],
          "circle-color": "#696969",
          "circle-opacity": 0.95
        }
      });

      // ─────────────────────────────────────
      // 4️⃣ City labels (engraved atlas style)
      // ─────────────────────────────────────
      map.addLayer({
        id: "marker-labels",
        type: "symbol",
        source: "poi-source",
        layout: {
          "text-field": ["get", "name"],
          "text-font": ["Noto Serif Regular"],
          "text-size": [
            "interpolate",
            ["linear"],
            ["zoom"],
            4, 16,
            10, 20
          ],
          "text-offset": [-0.75, 0],
          "text-anchor": "right",
          "text-allow-overlap": false,
          "symbol-placement": "point"
        },
        paint: {
          "text-color": "#222",
          "text-halo-color": "#f5f1e8",
          "text-halo-width": 1,
          "text-halo-blur": 0.5
        }
      });


      // Add click handler for popups
      map.on('click', 'poi-layer', (e) => {
        const coordinates = e.features[0].geometry.coordinates.slice();
        const { name, description } = e.features[0].properties;

        let popupHTML = `<h4>${name}</h4>`;
        if (description) popupHTML += `<p>${description}</p>`;

        new maplibregl.Popup()
          .setLngLat(coordinates)
          .setHTML(popupHTML)
          .addTo(map);
      });

      map.on('mouseenter', 'poi-layer', () => {
        map.getCanvas().style.cursor = 'pointer';
      });

      map.on('mouseleave', 'poi-layer', () => {
        map.getCanvas().style.cursor = '';
      });

      // Fit bounds
      const bounds = new maplibregl.LngLatBounds();
      pointsOfInterest.forEach(poi => bounds.extend([poi[1], poi[0]]));
      if (pointsOfInterest.length > 0) {
        map.fitBounds(bounds, { padding: 200, maxZoom: 15 });
      }
    });
  </script>
</body>

</html>